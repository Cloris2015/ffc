@model IEnumerable<DataModel.User>

@{
    ViewBag.Title = "User List";
}
<h2>User List</h2>

<p>
    @Html.ActionLink("Add New User", "Add")
</p>
<div class="container">
    <div class="row">
        <div class="table-responsive">
            <table class=" table table-striped table-bordered" cellspacing="0" style="width:100%" id=" table-pagination" data-pagination="true" data-search="true">
                <thead>
                    <tr>
                        <th>
                            @Html.DisplayNameFor(model => model.Name)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Email)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.Phone)
                        </th>
                        <th>
                            @Html.DisplayNameFor(model => model.BOD)
                        </th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="datatable">
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>
                                @Html.DisplayFor(modelItem => item.Name)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Email)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Phone)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.BOD)
                            </td>
                            <td>
                                @Html.ActionLink("Edit", "Edit", new { id = item.ID }) |
                                @Html.ActionLink("Details", "Details", new { id = item.ID }) |
                                @Html.ActionLink("Delete", "Delete", new { id = item.ID }, new { @class = "deletelink", userId = item.ID })
                            </td>
                        </tr>
                    }
                    </tbody>
    
</table>
       </div>     
    </div>
    <div class="col-md-12 text-center">
        <ul class="pagination pagination-lg pager" id="myPager"></ul>
    </div>
  </div>
        @section scripts{
            <script type="text/javascript">
                $(document).ready(function () {
                    $('.deletelink').click(
                        function (evt) {
                            evt.preventDefault();
                            if (!confirm("Are you sure to delete?")) {
                                return false;
                            }
                            var id = this.attributes["userId"].value;
                            $.ajax({
                                type: "POST",
                                url: '@Url.Content("~/User/Delete")',
                                data: { id: id }
                            })
                            .done(
                            function (data, textStatus, jqXHR) {
                                document.location.reload();
                            }
                            )

                        });

                });

                //Pagination scripts
                $.fn.pageMe = function (opts) {
                    var $this = this,
                        defaults = {
                            perPage: 1,
                            showPrevNext: false,
                            hidePageNumbers: false
                        },
                        settings = $.extend(defaults, opts);

                    var listElement = $this;
                    var perPage = settings.perPage;
                    var children = listElement.children();
                    var pager = $('.pager');

                    if (typeof settings.childSelector != "undefined") {
                        children = listElement.find(settings.childSelector);
                    }

                    if (typeof settings.pagerSelector != "undefined") {
                        pager = $(settings.pagerSelector);
                    }

                    var numItems = children.size();
                    var numPages = Math.ceil(numItems / perPage);
                    pager.data("curr", 0);

                    if (settings.showPrevNext) {
                        $('<li><a href="#" class="prev_link">«</a></li>').appendTo(pager);
                    }

                    var curr = 0;
                    while (numPages > curr && (settings.hidePageNumbers == false)) {
                        $('<li><a href="#" class="page_link">' + (curr + 1) + '</a></li>').appendTo(pager);
                        curr++;
                    }

                    if (settings.showPrevNext) {
                        $('<li><a href="#" class="next_link">»</a></li>').appendTo(pager);
                    }

                    pager.find('.page_link:first').addClass('active');
                    pager.find('.prev_link').hide();
                    if (numPages <= 1) {
                        pager.find('.next_link').hide();
                    }
                    pager.children().eq(1).addClass("active");

                    children.hide();
                    children.slice(0, perPage).show();

                    pager.find('li .page_link').click(function () {
                        var clickedPage = $(this).html().valueOf() - 1;
                        goTo(clickedPage, perPage);
                        return false;
                    });
                    pager.find('li .prev_link').click(function () {
                        previous();
                        return false;
                    });
                    pager.find('li .next_link').click(function () {
                        next();
                        return false;
                    });

                    function previous() {
                        var goToPage = parseInt(pager.data("curr")) - 1;
                        goTo(goToPage);
                    }

                    function next() {
                        goToPage = parseInt(pager.data("curr")) + 1;
                        goTo(goToPage);
                    }

                    function goTo(page) {
                        var startAt = page * perPage,
                            endOn = startAt + perPage;

                        children.css('display', 'none').slice(startAt, endOn).show();

                        if (page >= 1) {
                            pager.find('.prev_link').show();
                        }
                        else {
                            pager.find('.prev_link').hide();
                        }

                        if (page < (numPages - 1)) {
                            pager.find('.next_link').show();
                        }
                        else {
                            pager.find('.next_link').hide();
                        }

                        pager.data("curr", page);
                        pager.children().removeClass("active");
                        pager.children().eq(page + 1).addClass("active");

                    }
                };

                $(document).ready(function () {

                    $('#datatable').pageMe({ pagerSelector: '#myPager', showPrevNext: true, hidePageNumbers: false, perPage: 2 });

                });
            </script>
        }
